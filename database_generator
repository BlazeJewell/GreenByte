from greenbyte import db
from run import app

from greenbyte.models import User, Post, Garden, GrowSpace, Plant
from datetime import datetime, timedelta

with app.app_context():  # ✅ Ensuring proper app context
    # Uncomment the following lines if you want to reset the database
    db.drop_all()
    db.session.commit()
    db.create_all()

    # Create a sample user
    user1 = User(firstName="Blaze", lastName="Doe", email="temp@example.com", password="hashedpassword")
    db.session.add(user1)
    db.session.commit()

    # Create a sample garden
    garden1 = Garden(name="GreenByte Garden", location="California", owner_id=user1.id)
    db.session.add(garden1)
    db.session.commit()

    # Add user to garden
    user1.gardens.append(garden1)
    db.session.commit()

    # Create grow spaces (sections only)
    grow_spaces = [
        GrowSpace(name="Tomato Section", garden_id=garden1.id, section="A", planting_date=datetime.utcnow() - timedelta(days=30)),
        GrowSpace(name="Lettuce Section", garden_id=garden1.id, section="B", planting_date=datetime.utcnow() - timedelta(days=15)),
        GrowSpace(name="Pepper Greenhouse", garden_id=garden1.id, section="C", planting_date=datetime.utcnow() - timedelta(days=45)),
    ]
    db.session.add_all(grow_spaces)
    db.session.commit()

    # Create plants in grow spaces
    plants = [
        Plant(name="Tomato", planting_date=grow_spaces[0].planting_date, grow_space_id=grow_spaces[0].id),
        Plant(name="Lettuce", planting_date=grow_spaces[1].planting_date, grow_space_id=grow_spaces[1].id),
        Plant(name="Bell Pepper", planting_date=grow_spaces[2].planting_date, grow_space_id=grow_spaces[2].id),
    ]
    db.session.add_all(plants)
    db.session.commit()

    # Create sample posts related to plant progress
    for i in range(5):
        post = Post(
            title=f"Growth Update {i+1}",
            content=f"Plants are growing well in {grow_spaces[i % len(grow_spaces)].name}!",
            author=user1,  # ✅ Using `author` relationship
            grow_space_id=grow_spaces[i % len(grow_spaces)].id
        )
        db.session.add(post)

    db.session.commit()

    print("Sample data inserted successfully!")